<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Data Wrangling in R</title>
    <meta charset="utf-8" />
    <meta name="author" content="Prof. Bisbee" />
    <script src="libs/header-attrs-2.14/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/lexis.css" type="text/css" />
    <link rel="stylesheet" href="css/lexis-fonts.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Data Wrangling in <code>R</code>
]
.subtitle[
## Part 2
]
.author[
### Prof. Bisbee
]
.institute[
### Vanderbilt University
]
.date[
### Lecture Date: 2023/01/23
Slides Updated: 2022-12-26
]

---


&lt;style type="text/css"&gt;
.small .remark-code { /*Change made here*/
  font-size: 85% !important;
}
.tiny .remark-code { /*Change made here*/
  font-size: 50% !important;
}
&lt;/style&gt;



# Agenda

1. .blue[Research Camp]: 3 DS questions

2. Wrangling to answer

3. Preliminary **analysis**

---

# 3 Research Questions

--

- **Research Question**: Is education related with vote choice?

--

  - .blue[Theory]: Less educated hurt by free trade &amp;rarr; Trump opposes free trade
  
  - .red[Data]: Examine vote choice by educational attainment
  
--

- **Research Question**: Is gender related with vote choice?

--

  - .blue[Theory]: Trump routinely expresses norm-breaking sexist views
  
  - .red[Data]: Examine vote choice by gender
  
--

- **Research Question**: Is race related with vote choice?

--

  - .blue[Theory]: Trump courts fringe white nationalist groups
  
  - .red[Data]: Examine vote choice by race
  
---

# (Re-)Opening the data


```r
require(tidyverse)
load('../output/MI_prepped.RData') # Now load the data you created
glimpse(MI_final)
```

```
## Rows: 1,231
## Columns: 14
## $ SEX        &lt;dbl+lbl&gt; 2, 2, 2, 1, 2, 2, 1, 1, 2, 1, 1, 1,…
## $ AGE10      &lt;dbl+lbl&gt;  2, 10,  7,  9,  8,  7,  9,  8,  6,…
## $ PARTYID    &lt;dbl+lbl&gt; 3, 1, 1, 3, 3, 3, 1, 1, 2, 1, 3, 2,…
## $ WEIGHT     &lt;dbl&gt; 0.4045421, 1.8052619, 0.8601966, 0.1991…
## $ QRACEAI    &lt;dbl+lbl&gt; 1, 2, 1, 1, 1, 1, 1, 1, 1, 2, 9, 1,…
## $ EDUC18     &lt;dbl+lbl&gt; 4, 1, 5, 4, 5, 3, 3, 3, 4, 4, 5, 5,…
## $ LGBT       &lt;dbl+lbl&gt; NA,  2,  2, NA, NA,  2,  2,  2, NA,…
## $ BRNAGAIN   &lt;dbl+lbl&gt; NA,  1,  2, NA, NA,  2,  1,  2, NA,…
## $ LATINOS    &lt;dbl+lbl&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,…
## $ RACISM20   &lt;dbl+lbl&gt; NA,  2,  2, NA, NA,  2,  2,  2, NA,…
## $ QLT20      &lt;dbl+lbl&gt;  4, NA, NA,  4,  3, NA, NA, NA,  3,…
## $ Qlty       &lt;fct&gt; Has good judgment, NA, NA, Has good jud…
## $ PRSMI20    &lt;dbl+lbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 2, 2,…
## $ preschoice &lt;fct&gt; "Joe Biden, the Democrat", "Joe Biden, …
```

---

# Wrangling Requires Looking

--

- How much is missing for the variables `EDUC18`, `SEX`, and `RACISM20`?

--


```r
MI_final %&gt;%
  count(EDUC18)
```

```
## # A tibble: 6 × 2
##                                                 EDUC18     n
##                                              &lt;dbl+lbl&gt; &lt;int&gt;
## 1 1 [Never attended college]                             173
## 2 2 [Attended college but received no degree]            262
## 3 3 [An Associate’s degree (AA or AS)]                   190
## 4 4 [A Bachelor’s degree (BA or BS)]                     293
## 5 5 [An advanced degree after a bachelor’s degree (su…   302
## 6 9 [[DON'T READ] Don’t know/refused]                     11
```

---

# Look at the data

- How much is missing for the variables `LGBT`, `BRNAGAIN`, and `RACISM20`?


```r
MI_final %&gt;%
  count(SEX)
```

```
## # A tibble: 2 × 2
##          SEX     n
##    &lt;dbl+lbl&gt; &lt;int&gt;
## 1 1 [Male]     579
## 2 2 [Female]   652
```

---

# Look at the data
- How much is missing for the variables `LGBT`, `BRNAGAIN`, and `RACISM20`?


```r
MI_final %&gt;%
  count(RACISM20)
```

```
## # A tibble: 6 × 2
##                               RACISM20     n
##                              &lt;dbl+lbl&gt; &lt;int&gt;
## 1  1 [The most important problem]         41
## 2  2 [One of many important problems]    420
## 3  3 [A minor problem]                   109
## 4  4 [Not a problem at all]               38
## 5  9 [[DON'T READ] Don’t know/refused]     8
## 6 NA                                     615
```

---

# Look at the data

--

- `RACISM20` has 615 `NA` values!

--

- Some variables were only asked of half the sample

--

  - Polls often do this to avoid tiring out respondents
  
--

  - Random sampling &amp;rarr; the half that received these questions are the same as the half that didn't
  
--

  - In other words, they are **representative** of each other
  
---

# Look at the data

- Are there other variables that were only asked of half the respondents?

--


```r
summary(MI_final %&gt;% select(LGBT,BRNAGAIN,RACISM20,QLT20))
```

```
##       LGBT          BRNAGAIN        RACISM20    
##  Min.   :1.000   Min.   :1.000   Min.   :1.000  
##  1st Qu.:2.000   1st Qu.:1.000   1st Qu.:2.000  
##  Median :2.000   Median :2.000   Median :2.000  
##  Mean   :2.224   Mean   :1.907   Mean   :2.325  
##  3rd Qu.:2.000   3rd Qu.:2.000   3rd Qu.:3.000  
##  Max.   :9.000   Max.   :9.000   Max.   :9.000  
##  NA's   :615     NA's   :615     NA's   :615    
##      QLT20      
##  Min.   :1.000  
##  1st Qu.:2.000  
##  Median :3.000  
##  Mean   :2.956  
##  3rd Qu.:4.000  
##  Max.   :9.000  
##  NA's   :616
```

---

# Look at the data

- Were the same respondents asked the same questions?


```r
MI_final %&gt;%
  select(LGBT,BRNAGAIN,RACISM20,QLT20) %&gt;%
  drop_na(RACISM20)
```

```
## # A tibble: 616 × 4
##         LGBT  BRNAGAIN                        RACISM20 QLT20
##    &lt;dbl+lbl&gt; &lt;dbl+lbl&gt;                       &lt;dbl+lbl&gt; &lt;dbl&gt;
##  1    2 [No]   1 [Yes] 2 [One of many important probl…    NA
##  2    2 [No]   2 [No]  2 [One of many important probl…    NA
##  3    2 [No]   2 [No]  2 [One of many important probl…    NA
##  4    2 [No]   1 [Yes] 2 [One of many important probl…    NA
##  5    2 [No]   2 [No]  2 [One of many important probl…    NA
##  6    2 [No]   2 [No]  2 [One of many important probl…    NA
##  7    2 [No]   2 [No]  9 [[DON'T READ] Don’t know/ref…    NA
##  8    2 [No]   1 [Yes] 4 [Not a problem at all]           NA
##  9    2 [No]   2 [No]  3 [A minor problem]                NA
## 10    2 [No]   2 [No]  2 [One of many important probl…    NA
## # … with 606 more rows
```

---

# Look at the data

- No respondent answered all 4 questions!


```r
MI_final %&gt;%
  select(LGBT,BRNAGAIN,RACISM20,QLT20) %&gt;%
  drop_na()
```

```
## # A tibble: 0 × 4
## # … with 4 variables: LGBT &lt;dbl+lbl&gt;, BRNAGAIN &lt;dbl+lbl&gt;,
## #   RACISM20 &lt;dbl+lbl&gt;, QLT20 &lt;dbl+lbl&gt;
```


---

# Look at the data

- They **either** were asked about `QLT20` **or** identity questions


```r
MI_final %&gt;%
  select(LGBT,BRNAGAIN,RACISM20) %&gt;%
  drop_na()
```

```
## # A tibble: 616 × 3
##         LGBT  BRNAGAIN                            RACISM20
##    &lt;dbl+lbl&gt; &lt;dbl+lbl&gt;                           &lt;dbl+lbl&gt;
##  1    2 [No]   1 [Yes] 2 [One of many important problems] 
##  2    2 [No]   2 [No]  2 [One of many important problems] 
##  3    2 [No]   2 [No]  2 [One of many important problems] 
##  4    2 [No]   1 [Yes] 2 [One of many important problems] 
##  5    2 [No]   2 [No]  2 [One of many important problems] 
##  6    2 [No]   2 [No]  2 [One of many important problems] 
##  7    2 [No]   2 [No]  9 [[DON'T READ] Don’t know/refused]
##  8    2 [No]   1 [Yes] 4 [Not a problem at all]           
##  9    2 [No]   2 [No]  3 [A minor problem]                
## 10    2 [No]   2 [No]  2 [One of many important problems] 
## # … with 606 more rows
```


---

# Missingness

--

- Is there other missingness?

--


```r
MI_final %&gt;%
  drop_na(RACISM20) %&gt;%
  count(RACISM20)
```

```
## # A tibble: 5 × 2
##                              RACISM20     n
##                             &lt;dbl+lbl&gt; &lt;int&gt;
## 1 1 [The most important problem]         41
## 2 2 [One of many important problems]    420
## 3 3 [A minor problem]                   109
## 4 4 [Not a problem at all]               38
## 5 9 [[DON'T READ] Don’t know/refused]     8
```

--

- Unit non-response...8 respondents just skipped this question
  
--

  - Why not record these as `NA` too? Non-response might be interesting!
  
---

# `rename`

--

- Let's change the variable name for the three questions that were only asked of half the survey


```r
MI_final &lt;- MI_final %&gt;%
  rename(LGBT_split = LGBT,
         BRNAGAIN_split = BRNAGAIN,
         RACISM_split = RACISM20)
```

--

- NB: all we've done is change the names of `LGBT`, `BRNAGAIN`, and `RACISM20`.


```r
MI_final %&gt;%
  select(matches('LGBT|BRNAGAIN|RACISM'))
```

```
## # A tibble: 1,231 × 3
##    LGBT_split BRNAGAIN_split                    RACISM_split
##     &lt;dbl+lbl&gt;      &lt;dbl+lbl&gt;                       &lt;dbl+lbl&gt;
##  1    NA            NA       NA                             
##  2     2 [No]        1 [Yes]  2 [One of many important prob…
##  3     2 [No]        2 [No]   2 [One of many important prob…
##  4    NA            NA       NA                             
##  5    NA            NA       NA                             
##  6     2 [No]        2 [No]   2 [One of many important prob…
##  7     2 [No]        1 [Yes]  2 [One of many important prob…
##  8     2 [No]        2 [No]   2 [One of many important prob…
##  9    NA            NA       NA                             
## 10    NA            NA       NA                             
## # … with 1,221 more rows
```

---

# Recoding using `mutate`

--

- If we want to recode `SEX` to be more interpretable, we can use mutate

--

  - Currently, `SEX` is coded `1` for `Male` and `2` for `Female`
  

```r
MI_final %&gt;%
  count(SEX)
```

```
## # A tibble: 2 × 2
##          SEX     n
##    &lt;dbl+lbl&gt; &lt;int&gt;
## 1 1 [Male]     579
## 2 2 [Female]   652
```

--

  - What if we want to create a new variable that takes on the value `1` for `Female` and `0` for `Male`?

---

# Recoding using `mutate`


```r
MI_final %&gt;%
  mutate(FEMALE = SEX - 1) %&gt;%
  select(FEMALE,SEX)
```

```
## # A tibble: 1,231 × 2
##    FEMALE        SEX
##     &lt;dbl&gt;  &lt;dbl+lbl&gt;
##  1      1 2 [Female]
##  2      1 2 [Female]
##  3      1 2 [Female]
##  4      0 1 [Male]  
##  5      1 2 [Female]
##  6      1 2 [Female]
##  7      0 1 [Male]  
##  8      0 1 [Male]  
##  9      1 2 [Female]
## 10      0 1 [Male]  
## # … with 1,221 more rows
```

---

# Recoding using `mutate`

- Alternatively, we could have used `ifelse` instead

--


```r
MI_final %&gt;%
  mutate(FEMALE = ifelse(SEX == 2,1,0)) %&gt;%
  select(FEMALE,SEX)
```

```
## # A tibble: 1,231 × 2
##    FEMALE        SEX
##     &lt;dbl&gt;  &lt;dbl+lbl&gt;
##  1      1 2 [Female]
##  2      1 2 [Female]
##  3      1 2 [Female]
##  4      0 1 [Male]  
##  5      1 2 [Female]
##  6      1 2 [Female]
##  7      0 1 [Male]  
##  8      0 1 [Male]  
##  9      1 2 [Female]
## 10      0 1 [Male]  
## # … with 1,221 more rows
```


---

# Recoding using `mutate`

- "Dummy" variables allow us to calculate the mean to see the proportion of respondents who are `Female`

--


```r
MI_final &lt;- MI_final %&gt;%
  mutate(FEMALE = SEX - 1)

mean(MI_final$FEMALE,na.rm=T)
```

```
## [1] 0.5296507
```

---

# Recoding using `mutate`

- In this case, it is easier to just use `SEX - 1`

--

- However, what if we wanted a `chr` version of the `SEX` variable?


```r
MI_final &lt;- MI_final %&gt;%
  mutate(SEX.chr = ifelse(SEX == 1,'Male','Female'))
```

--

- Or if the underlying variable wasn't numeric?


```r
MI_final &lt;- MI_final %&gt;%
  mutate(BidenVoter = ifelse(grepl('Biden',preschoice),1,0),
         TrumpVoter = ifelse(grepl('Trump',preschoice),1,0))
```

---

# The `else` of `ifelse`

--

- `ifelse([LOGIC],[VALUE IF TRUE],[VALUE IF FALSE])`

--

  - `ifelse(grepl('Biden',preschoice),1,0)`

--

  - If `Biden` is in the `preschoice`, return a `1`
  
--

  - Otherwise, return a `0`
  
--

- `0` captures Trump + Other + did not vote

&lt;center&gt;&lt;img src='figs/PresQ.png'&gt;&lt;/center&gt;

---

# The `else` of `ifelse`

- We can set the `else` value to the variable itself


```r
MI_final %&gt;%
  count(preschoice)
```

```
## # A tibble: 6 × 2
##   preschoice                          n
##   &lt;fct&gt;                           &lt;int&gt;
## 1 Will/Did not vote for president     6
## 2 Joe Biden, the Democrat           723
## 3 Donald Trump, the Republican      459
## 4 Undecided/Don’t know                4
## 5 Refused                            14
## 6 Another candidate                  25
```


---

# The `else` of `ifelse`

- We can set the `else` value to the variable itself


```r
MI_final %&gt;%
  mutate(choice2 = ifelse(preschoice == 'Refused',NA,preschoice)) %&gt;%
  count(choice2)
```

```
## # A tibble: 6 × 2
##   choice2     n
##     &lt;int&gt; &lt;int&gt;
## 1       1     6
## 2       2   723
## 3       3   459
## 4       4     4
## 5       6    25
## 6      NA    14
```

---

# Sequential `ifelse`

--


```r
MI_final %&gt;%
  mutate(preschoice = ifelse(grepl('Another',preschoice),NA,preschoice),
         preschoice = ifelse(grepl('Did not vote',preschoice),NA,preschoice),
         preschoice = ifelse(grepl('Undecided',preschoice),NA,preschoice)) %&gt;%
  count(preschoice)
```

```
## # A tibble: 6 × 2
##   preschoice     n
##        &lt;int&gt; &lt;int&gt;
## 1          1     6
## 2          2   723
## 3          3   459
## 4          4     4
## 5          5    14
## 6         NA    25
```

---

# Nested `ifelse`

- `ifelse([LOGIC],[IF TRUE],ifelse([LOGIC],[IF TRUE],[IF FALSE]))`


```r
MI_final %&gt;%
  mutate(preschoice = ifelse(grepl('Another',preschoice),NA,
                             ifelse(grepl('Did not vote',preschoice),NA,
                                    ifelse(grepl('Undecided',preschoice),NA,preschoice)))) %&gt;%
  count(preschoice)
```

```
## # A tibble: 4 × 2
##   preschoice     n
##        &lt;int&gt; &lt;int&gt;
## 1          2   723
## 2          3   459
## 3          5    14
## 4         NA    35
```

---

# Combined `ifelse`

- Or more succinctly


```r
MI_final %&gt;%
  mutate(preschoice = ifelse(grepl('Another|Did not vote|Undecided|Refused',preschoice),NA,preschoice)) %&gt;%
  count(preschoice)
```

```
## # A tibble: 3 × 2
##   preschoice     n
##        &lt;int&gt; &lt;int&gt;
## 1          2   723
## 2          3   459
## 3         NA    49
```

---

# Combining `count` with `mutate`

--

- Counts of respondents aren't as intuitive as proportions


```r
MI_final %&gt;%
  filter(grepl('Biden|Trump',preschoice)) %&gt;%
  count(preschoice) %&gt;%
  mutate(PctSupport = n / sum(n))
```

```
## # A tibble: 2 × 3
##   preschoice                       n PctSupport
##   &lt;fct&gt;                        &lt;int&gt;      &lt;dbl&gt;
## 1 Joe Biden, the Democrat        723      0.612
## 2 Donald Trump, the Republican   459      0.388
```


---

# Wrangling Choices Matter!


```r
# Method 1
MI_final %&gt;%
  filter(grepl('Biden|Trump',preschoice)) %&gt;%
  count(preschoice) %&gt;%
  mutate(PctSupport = n / sum(n))
```

```
## # A tibble: 2 × 3
##   preschoice                       n PctSupport
##   &lt;fct&gt;                        &lt;int&gt;      &lt;dbl&gt;
## 1 Joe Biden, the Democrat        723      0.612
## 2 Donald Trump, the Republican   459      0.388
```

```r
# Method 2
MI_final %&gt;%
  summarise(PctBiden = mean(BidenVoter),
            PctTrump = mean(TrumpVoter))
```

```
## # A tibble: 1 × 2
##   PctBiden PctTrump
##      &lt;dbl&gt;    &lt;dbl&gt;
## 1    0.587    0.373
```

---

# Wrangling Choices Matter!

- Why are these different?!

--

- `filter()` means the **denominator is different**


```r
MI_final %&gt;%
  filter(grepl('Biden|Trump',preschoice)) %&gt;%
  summarise(PctBiden = mean(BidenVoter),
            PctTrump = mean(TrumpVoter))
```

```
## # A tibble: 1 × 2
##   PctBiden PctTrump
##      &lt;dbl&gt;    &lt;dbl&gt;
## 1    0.612    0.388
```

---

# Other ways of summarizing

--

- Thus far, taking averages

--

- Can also look at `sd`, `median`, `min`, `max`


```r
MI_final %&gt;%
  summarise(avgBiden = mean(BidenVoter),
            sdBiden = sd(BidenVoter),
            medBiden = median(BidenVoter),
            minBiden = min(BidenVoter),
            maxBiden = max(BidenVoter))
```

```
## # A tibble: 1 × 5
##   avgBiden sdBiden medBiden minBiden maxBiden
##      &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1    0.587   0.493        1        0        1
```

---

# Other ways of summarizing

--

- Could also just use `summary()`


```r
summary(MI_final$BidenVoter)
```

```
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.0000  0.0000  1.0000  0.5873  1.0000  1.0000
```

---

# Non-binary Variables

--

- Thus far, focusing on categorical data (`preschoice`) but treating it like a binary variable (only looking at Biden and Trump)

--

- What about `RACISM20`? (Don't forget that we `rename()`-ed it!)

--


```r
MI_final %&gt;%
  count(RACISM_split)
```

```
## # A tibble: 6 × 2
##                           RACISM_split     n
##                              &lt;dbl+lbl&gt; &lt;int&gt;
## 1  1 [The most important problem]         41
## 2  2 [One of many important problems]    420
## 3  3 [A minor problem]                   109
## 4  4 [Not a problem at all]               38
## 5  9 [[DON'T READ] Don’t know/refused]     8
## 6 NA                                     615
```

---

# Non-binary Variables

--

- Does it make sense to take the average of this?


```r
MI_final %&gt;%
  summarise(avgRacism = mean(RACISM_split))
```

```
## # A tibble: 1 × 1
##   avgRacism
##       &lt;dbl&gt;
## 1        NA
```

--

- Don't forget about `NA`!


```r
MI_final %&gt;%
  drop_na(RACISM_split) %&gt;%
  summarise(avgRacism = mean(RACISM_split))
```

```
## # A tibble: 1 × 1
##   avgRacism
##       &lt;dbl&gt;
## 1      2.32
```

---

# Non-binary Variables

--

- But we also have unit non-response (coded as `9`)


```r
MI_final %&gt;%
  count(RACISM_split)
```

```
## # A tibble: 6 × 2
##                           RACISM_split     n
##                              &lt;dbl+lbl&gt; &lt;int&gt;
## 1  1 [The most important problem]         41
## 2  2 [One of many important problems]    420
## 3  3 [A minor problem]                   109
## 4  4 [Not a problem at all]               38
## 5  9 [[DON'T READ] Don’t know/refused]     8
## 6 NA                                     615
```

- If we ignore this, we will over-estimate the degree to which Michigan voters don't think racism is a problem!

---

# Non-binary Variables


```r
MI_final %&gt;%
  mutate(RACISM_split = ifelse(RACISM_split == 9,NA,RACISM_split)) %&gt;%
  summarise(avgRacism = mean(RACISM_split,na.rm=T))
```

```
## # A tibble: 1 × 1
##   avgRacism
##       &lt;dbl&gt;
## 1      2.24
```

--

- What did we do?

--

  1. Converted `9` to `NA`
  2. Took the `mean()` with `na.rm=T` (equivalent to `drop_na(RACISM_split)`)
  
---

# Where is the .blue[science]?

--

- **Research Question**: Is education related with vote choice?

--

  - .blue[Theory]: Less educated hurt by free trade &amp;rarr; Trump opposes free trade
  
  - .red[Data]: Examine vote choice by educational attainment

--


```r
MI_final %&gt;%
  group_by(preschoice,EDUC18)
```

```
## # A tibble: 1,231 × 18
## # Groups:   preschoice, EDUC18 [30]
##           SEX           AGE10     PARTYID WEIGHT   QRACEAI
##     &lt;dbl+lbl&gt;       &lt;dbl+lbl&gt;   &lt;dbl+lbl&gt;  &lt;dbl&gt; &lt;dbl+lbl&gt;
##  1 2 [Female]  2 [25 and 29,] 3 [Indepen…  0.405 1 [White]
##  2 2 [Female] 10 [75 or over… 1 [Democra…  1.81  2 [Black]
##  3 2 [Female]  7 [50 and 59,] 1 [Democra…  0.860 1 [White]
##  4 1 [Male]    9 [65 and 74,] 3 [Indepen…  0.199 1 [White]
##  5 2 [Female]  8 [60 and 64,] 3 [Indepen…  0.177 1 [White]
##  6 2 [Female]  7 [50 and 59,] 3 [Indepen…  0.492 1 [White]
##  7 1 [Male]    9 [65 and 74,] 1 [Democra…  1.37  1 [White]
##  8 1 [Male]    8 [60 and 64,] 1 [Democra…  1.15  1 [White]
##  9 2 [Female]  6 [45 and 49,] 2 [Republi…  1.50  1 [White]
## 10 1 [Male]    8 [60 and 64,] 1 [Democra…  1.30  2 [Black]
## # … with 1,221 more rows, and 13 more variables:
## #   EDUC18 &lt;dbl+lbl&gt;, LGBT_split &lt;dbl+lbl&gt;,
## #   BRNAGAIN_split &lt;dbl+lbl&gt;, LATINOS &lt;dbl+lbl&gt;,
## #   RACISM_split &lt;dbl+lbl&gt;, QLT20 &lt;dbl+lbl&gt;, Qlty &lt;fct&gt;,
## #   PRSMI20 &lt;dbl+lbl&gt;, preschoice &lt;fct&gt;, FEMALE &lt;dbl&gt;,
## #   SEX.chr &lt;chr&gt;, BidenVoter &lt;dbl&gt;, TrumpVoter &lt;dbl&gt;
```

---

# Wrangle TMI


```r
MI_final &lt;- MI_final %&gt;%
  mutate(educ_3 = ifelse(EDUC18 == 1,'No College',
                         ifelse(EDUC18 == 2,'Some College',
                                ifelse(EDUC18 %in% 3:5,'College Degree',NA))))
MI_final %&gt;%
  count(EDUC18,educ_3)
```

```
## # A tibble: 6 × 3
##                                          EDUC18 educ_3     n
##                                       &lt;dbl+lbl&gt; &lt;chr&gt;  &lt;int&gt;
## 1 1 [Never attended college]                    No Co…   173
## 2 2 [Attended college but received no degree]   Some …   262
## 3 3 [An Associate’s degree (AA or AS)]          Colle…   190
## 4 4 [A Bachelor’s degree (BA or BS)]            Colle…   293
## 5 5 [An advanced degree after a bachelor’s deg… Colle…   302
## 6 9 [[DON'T READ] Don’t know/refused]           &lt;NA&gt;      11
```

---

# Vote Choice by Education

--

- .blue[Theory]: Less educated should support Trump for **instrumental** reasons


```r
MI_final %&gt;%
  group_by(educ_3) %&gt;%
  summarise(TrumpVoter = mean(TrumpVoter,na.rm=T),
            totResp = n())
```

```
## # A tibble: 4 × 3
##   educ_3         TrumpVoter totResp
##   &lt;chr&gt;               &lt;dbl&gt;   &lt;int&gt;
## 1 College Degree      0.349     785
## 2 No College          0.428     173
## 3 Some College        0.405     262
## 4 &lt;NA&gt;                0.455      11
```

---

# Vote Choice by Education

- .blue[Theory]: Less educated should support Trump for **instrumental** reasons


```r
MI_final %&gt;%
  group_by(TrumpVoter,educ_3) %&gt;%
  count()
```

```
## # A tibble: 8 × 3
## # Groups:   TrumpVoter, educ_3 [8]
##   TrumpVoter educ_3             n
##        &lt;dbl&gt; &lt;chr&gt;          &lt;int&gt;
## 1          0 College Degree   511
## 2          0 No College        99
## 3          0 Some College     156
## 4          0 &lt;NA&gt;               6
## 5          1 College Degree   274
## 6          1 No College        74
## 7          1 Some College     106
## 8          1 &lt;NA&gt;               5
```

---

# Vote Choice by Education


```r
MI_final %&gt;%
  ggplot(aes(x = educ_3,fill = factor(TrumpVoter))) + 
  geom_bar(stat = 'count')
```

&lt;img src="Lecture_2023_01_23_slides_files/figure-html/unnamed-chunk-39-1.png" style="display: block; margin: auto;" /&gt;

---

# Vote Choice by Education


```r
MI_final %&gt;%
  group_by(educ_3,TrumpVoter) %&gt;%
  count() %&gt;%
  ggplot(aes(x = educ_3,y = n,fill = factor(TrumpVoter))) + 
  geom_bar(stat = 'identity')
```

&lt;img src="Lecture_2023_01_23_slides_files/figure-html/unnamed-chunk-40-1.png" style="display: block; margin: auto;" /&gt;

---

# Vote Choice by Education


```r
MI_final %&gt;%
  group_by(educ_3,TrumpVoter) %&gt;%
  count() %&gt;%
* ggplot(aes(x = reorder(educ_3,n),y = n,fill = factor(TrumpVoter))) +
  geom_bar(stat = 'identity')
```

&lt;img src="Lecture_2023_01_23_slides_files/figure-html/unnamed-chunk-41-1.png" style="display: block; margin: auto;" /&gt;


---

# Vote Choice by Education

- Is this a good plot?

--

  - Remember the .blue[theory]!
  
--

  - Want to know if less educated are more likely to vote Trump
  
--

- Let's calculate shares instead of counts


```r
p &lt;- MI_final %&gt;%
  group_by(educ_3,TrumpVoter) %&gt;%
  count() %&gt;%
  group_by(educ_3) %&gt;%
  mutate(share = n / sum(n)) %&gt;%
  ggplot(aes(x = reorder(educ_3,n),y = share,fill = factor(TrumpVoter))) + 
  geom_bar(stat = 'identity')
```

---

# Vote Choice by Education

&lt;img src="Lecture_2023_01_23_slides_files/figure-html/unnamed-chunk-43-1.png" style="display: block; margin: auto;" /&gt;

---

# Vote Choice by Education

- `NA` category is very small, but looks big

--

- Remove it with `drop_na(educ_3)`


```r
p &lt;- MI_final %&gt;%
  group_by(educ_3,TrumpVoter) %&gt;%
  count() %&gt;%
  group_by(educ_3) %&gt;%
  mutate(share = n / sum(n)) %&gt;%
  drop_na(educ_3) %&gt;%
  ggplot(aes(x = reorder(educ_3,n),y = share,fill = factor(TrumpVoter))) + 
  geom_bar(stat = 'identity')
```


---

# Vote Choice by Education

&lt;img src="Lecture_2023_01_23_slides_files/figure-html/unnamed-chunk-45-1.png" style="display: block; margin: auto;" /&gt;

---

# Vote Choice by Education

- Remember the scientific method

&lt;img src="Lecture_2023_01_23_slides_files/figure-html/unnamed-chunk-46-1.png" style="display: block; margin: auto;" /&gt;

--

- We need to .blue[interpret] the .red[result] to answer the **research question**

--

  - "Less educated respondents are more likely to vote for Trump."
  
--

  - "Less educated respondents *in Michigan* **were** more likely to vote for Trump *in the 2020 U.S. Presidential Election*."

--

- How sure are we?

---

# More if there is time

- Differences in concern about racism by party


```r
MI_final %&gt;%
  filter(PARTYID %in% c(1:3)) %&gt;%
  mutate(RACISM_split = ifelse(RACISM_split == 9,NA,RACISM_split)) %&gt;%
  group_by(PARTYID) %&gt;%
  summarise(avgRacism = mean(RACISM_split,na.rm=T))
```

```
## # A tibble: 3 × 2
##           PARTYID avgRacism
##         &lt;dbl+lbl&gt;     &lt;dbl&gt;
## 1 1 [Democrat]         1.95
## 2 2 [Republican]       2.63
## 3 3 [Independent]      2.21
```

---

# Where is the .blue[science]?

- What does this mean?

&lt;center&gt;&lt;img src='figs/RaceQ.png'&gt;&lt;/center&gt;

---

# Visualizing Categorical Data

--

- Wrangle


 \small


```r
require(sjlabelled)
lookupPid &lt;- data.frame(vals = get_values(MI_final$PARTYID),
                        pid3 = get_labels(MI_final$PARTYID))
lookupRac &lt;- data.frame(vals = get_values(MI_final$RACISM_split),
                        rac = get_labels(MI_final$RACISM_split))
toplot &lt;- MI_final %&gt;%
  filter(PARTYID %in% c(1:3)) %&gt;%
  mutate(RACISM = ifelse(RACISM_split == 9,NA,RACISM_split)) %&gt;%
  select(PARTYID,RACISM) %&gt;%
  filter(complete.cases(.)) %&gt;%
  left_join(lookupPid,by = c('PARTYID' = 'vals')) %&gt;%
  left_join(lookupRac,by = c('RACISM' = 'vals')) %&gt;%
  mutate(rac = factor(rac,
                      levels = c('The most important problem',
                                 'One of many important problems',
                                 'A minor problem',
                                 'Not a problem at all')))
```

 \normalsize

---

# Visualizing Categorical Data


```r
toplot %&gt;% 
  ggplot(aes(x = rac,fill = pid3)) +
  geom_bar(stat = 'count')
```

&lt;img src="Lecture_2023_01_23_slides_files/figure-html/unnamed-chunk-49-1.png" style="display: block; margin: auto;" /&gt;

---

# Visualizing Categorical Data


```r
toplot %&gt;% 
  ggplot(aes(x = rac,fill = pid3)) +
  geom_bar(stat = 'count',position = 'fill')
```

&lt;img src="Lecture_2023_01_23_slides_files/figure-html/unnamed-chunk-50-1.png" style="display: block; margin: auto;" /&gt;
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="libs/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
