---
title: "Problem Set 10"
author: "Prof. Bisbee"
institute: "Vanderbilt University"
date: "Due Date: 2022/12/04 @ 11:59PM CST"
output:
  html_document: default
  pdf_document: default
---

## Getting Set Up

If you haven't already, create a folder for this course, and then a subfolder called `Topic10_Classification`, and two additional subfolders within `code` and `data`.

Open `RStudio` and create a new RMarkDown file (`.Rmd`) by going to `File -> New File -> R Markdown...`.
Change the title to `"DS1000: Problem Set 10"` and the author to your full name. Save this file as `[LAST NAME]_ps10.Rmd` to your `code` folder.

If you haven't already, download the `admit_data.rds` file from the course [github page](https://github.com/jbisbee1/DS1000-F2022/blob/master/Lectures/Topic10_Classification/data/admit_data.rds) and save it to your `data` folder.

```{r,include=F}
knitr::opts_chunk$set(error=TRUE)
```

Require `tidyverse`, `tidymodels`, and `modelr` and then load the `admit_data.rds` data to `ad`. Finally, `set.seed(123)` once at the very beginning, to ensure consistency in results throughout the problem set.
```{r}
# INSERT CODE HERE
```


## Question 1 [4 points]

Create a classification algorithm using linear regression that predicts attendance (`yield`) as a function of the following $X$ predictors:

- `distance`
- `income`
- `sat`
- `gpa`
- `visit`
- `registered`
- `legacy`
- `net_price`

Evaluate the model performance using `roc_auc` based on cross validation with 100 iterations, using an 80-20% split of the data. Then run a second algorithm that is identical to the first in every way, except that `income` is logged (`log_income = log(income)`). Compare the average AUC for the two models and discuss which is better.

**HINTS**:

* [Linear regression for classification](https://www.jamesbisbee.com/DS1000-F2022/Lectures/Topic10_Classification/code/Topic10_Classification_part1_slides.html#81)

* [Cross validation loop](https://www.jamesbisbee.com/DS1000-F2022/Lectures/Topic10_Classification/code/Topic10_Classification_part3_slides.html#23)

```{r}
# INSERT CODE HERE
```

> - Write 1 to 2 sentences here.

## Question 2 [4 points]

Re-do question 1 but use a logistic regression instead of a linear regression. Including the response to Question 1, you should end up with 100 AUC scores for each of the four algorithms by the end of this question:

- `lm` with raw `income`
- `lm` with `log_income`
- `glm` with raw `income`
- `glm` with `log_income`

Plot these AUC scores using `geom_boxplot()`, and discuss which of the four algorithms performs best. 

**NB:** Make sure that `warning = F` in the first part of the beginning of the `r` code chunk!

**HINTS**:

* [Logit regression](https://www.jamesbisbee.com/DS1000-F2022/Lectures/Topic10_Classification/code/Topic10_Classification_part2_slides.html#35)


```{r,warning = F}
# INSERT CODE HERE
```

> - Write 1 to 2 sentences here.

## Question 3 [4 points]

Based on the result to question 2, choose the best classification algorithm and train it on the full data. Calculate the specificity and sensitivity across different thresholds ranging from zero to one, and plot these as different colored lines, just as you did in PSet 9, Q4. What is the optimal threshold to balance the trade-off between sensitivity and specificity based on this plot? **HINT**: Use `geom_vline()` and test different `xintercept` values until you nail the intersection between the two lines.

**HINTS**:

* [Threshold loop](https://www.jamesbisbee.com/DS1000-F2022/Lectures/Topic10_Classification/code/Topic10_Classification_part1_slides.html#95)


```{r,warning = F}
# INSERT CODE HERE
```

> - Write 1 to 2 sentences here.

## Question 4 [4 points + 1 extra credit]

Try to increase the number of admitted students with incomes under \$50,000 by 200. To do this, you will first need to calculate the total number of admitted students currently with incomes under \$50,000, in order to know what number you should target. Then, create a hypothetical dataset using `data_grid()` and set `net_price` to be \$5k cheaper for those with incomes less than \$50k. Calculate the predicted number of admitted students with incomes less than \$50k by using the optimal threshold identified in Q3. Does reducing the price for lower-income students by \$5k achieve the goal of 200 more admits in this category? If not, try tweaking the price further until you achieve the goal. Is this possible? EXTRA CREDIT: Explain why the current number of attending students under \$50k is larger than the predicted number of attending students after reducing `net_price` by \$5,000.

**HINTS**:

* [Predicting on hypothetical data via `data_grid()`](https://www.jamesbisbee.com/DS1000-F2022/Lectures/Topic10_Classification/code/Topic10_Classification_part3_slides.html#37)

* [Predicting on hypothetical raw data](https://www.jamesbisbee.com/DS1000-F2022/Lectures/Topic10_Classification/code/Topic10_Classification_part3_slides.html#51)


```{r}
# INSERT CODE HERE
```

> - Write 3 to 5 sentences here.

## Question 5 [4 points]

Re-do question 4, while also achieving the college's two constraints: 

1. Maintain total revenues of at least \$30m
2. Maintain total attendance at least 1,466

Is this possible to achieve?

```{r}
# INSERT CODE HERE
```

> - Write 2 to 4 sentences here.

## Question 6 [4 EC points]

Now try and achieve BOTH goals subject to BOTH constraints. Specifically:

1. **Goal:** Increase average SAT to 1300
2. **Goal:** Increase lower-income students by 200
3. **Constraint:** Maintain revenues of at least \$30m
4. **Constraint:** Maintain total attendees of roughly 

```{r}
# INSERT CODE HERE
```