---
title: "Classification"
subtitle: "Review"
author: "Prof. Bisbee"
institute: "Vanderbilt University"
date: "Lecture Date: 2022/11/30\n Slides Updated: `r Sys.Date()`"
output:
  xaringan::moon_reader:
    # self_contained: true
    chakra: libs/remark-latest.min.js
    lib_dir: libs
    css:
      - default
      - css/lexis.css
      - css/lexis-fonts.css
    #seal: false
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      #ratio: "16:9"

---

```{css,echo = F}
.small .remark-code { /*Change made here*/
  font-size: 85% !important;
}
.tiny .remark-code { /*Change made here*/
  font-size: 50% !important;
}
```

```{r,include=F}
options(width=60)
knitr::opts_chunk$set(fig.align='center',fig.width=9,fig.height=5)
def.chunk.hook  <- knitr::knit_hooks$get("chunk")
knitr::knit_hooks$set(chunk = function(x, options) {
  x <- def.chunk.hook(x, options)
  ifelse(options$size != "normalsize", paste0("\n \\", options$size,"\n\n", x, "\n\n \\normalsize"), x)
})
```

# Agenda

1. Two questions

2. Demonstration

3. Student questions

---

# Two Questions

- Thresholds

--

- What is the point of plotting **sensitivity** versus **specificity**?

--

  - Identify an *optimal* threshold
  
--

- What is **optimal**?

--

  - Maximize both **sensitivity** and **specificity**
  
---

# Two Questions

- Thresholds

--

```{r,message=F,warning = F}
require(tidyverse)
ad <- readRDS('../data/admit_data.rds')
m1 <- glm(yield ~ sat + income,ad,family = binomial(link = 'logit'))
toplot <- NULL
for(thresh in seq(0,1,by = 0.025)) {
  toplot <- ad %>%
  mutate(pred_attend = ifelse(predict(m1,type = 'response') > thresh,1,0)) %>%
  group_by(yield) %>%
  mutate(total_attend = n()) %>%
  group_by(yield,pred_attend,total_attend) %>%
  summarise(nStudents=n(),.groups = 'drop') %>%
  mutate(prop = nStudents / total_attend) %>%
  mutate(threshold = thresh) %>%
    bind_rows(toplot)
}
```

---

# Two Questions

- Thresholds

```{r}
# Plot relationship between threshold and sens/spec
p <- toplot %>%
  mutate(metric = ifelse(yield == 1 & pred_attend == 1,'Sensitivity',
                         ifelse(yield == 0 & pred_attend == 0,'Specificity',NA))) %>%
  drop_na(metric) %>%
  ggplot(aes(x = threshold,y = prop,color = metric)) + 
  geom_line() + 
  geom_vline(xintercept = .635) + 
  labs(title = 'Sensitivity and Specificity by Threshold',
       subtitle = 'Model: Linear Regression',
       x = 'Threshold',
       y = 'Proportion Correct',
       color = 'Metric')
```

---

# Two Questions

- Thresholds

```{r}
p
```

---

# Two Questions

- How can we do something like this?


```{r,message=F}
hypo <- ad %>%
 mutate(net_price = ifelse(sat > 1300, # Logical statement #<<
                            net_price - 1000,
                            ifelse(sat < 1300,
                                   net_price + 1000,
                                   net_price)),
         visit = ifelse(sat > 1300,
                            1,
                            ifelse(sat < 1300,
                                   0,visit)),
         registered = ifelse(sat > 1300,
                            1,
                            ifelse(sat < 1300,
                                   0,registered)),
        legacy = ifelse(sat > 1300,1,legacy),
        gpa = ifelse(sat > 1300,3.9,gpa),
        income = ifelse(sat > 1300,150000,income),
        distance = ifelse(sat > 1300,100,distance))
```

---

# Two Questions

- How can we do something like this?


```{r,message=F}
hypo <- ad %>%
 mutate(net_price = ifelse(sat > 1300, # Logical statement #<<
                            net_price - 1000, # Value if true #<<
                            ifelse(sat < 1300,
                                   net_price + 1000,
                                   net_price)),
         visit = ifelse(sat > 1300,
                            1,
                            ifelse(sat < 1300,
                                   0,visit)),
         registered = ifelse(sat > 1300,
                            1,
                            ifelse(sat < 1300,
                                   0,registered)),
        legacy = ifelse(sat > 1300,1,legacy),
        gpa = ifelse(sat > 1300,3.9,gpa),
        income = ifelse(sat > 1300,150000,income),
        distance = ifelse(sat > 1300,100,distance))
```

---

# Two Questions

- How can we do something like this?


```{r,message=F}
hypo <- ad %>%
 mutate(net_price = ifelse(sat > 1300, # Logical statement #<<
                            net_price - 1000, # Value if true #<<
                            ifelse(sat < 1300, # Value if false #<<
                                   net_price + 1000,
                                   net_price)),
         visit = ifelse(sat > 1300,
                            1,
                            ifelse(sat < 1300,
                                   0,visit)),
         registered = ifelse(sat > 1300,
                            1,
                            ifelse(sat < 1300,
                                   0,registered)),
        legacy = ifelse(sat > 1300,1,legacy),
        gpa = ifelse(sat > 1300,3.9,gpa),
        income = ifelse(sat > 1300,150000,income),
        distance = ifelse(sat > 1300,100,distance))
```


---

# Two Questions

- How can we do something like this?


```{r,message=F}
hypo <- ad %>%
 mutate(net_price = ifelse(sat > 1300, # Logical statement #<<
                            net_price - 1000, # Value if true #<<
                            ifelse(sat < 1300, # Nested logic! #<<
                                   net_price + 1000,
                                   net_price)),
         visit = ifelse(sat > 1300,
                            1,
                            ifelse(sat < 1300,
                                   0,visit)),
         registered = ifelse(sat > 1300,
                            1,
                            ifelse(sat < 1300,
                                   0,registered)),
        legacy = ifelse(sat > 1300,1,legacy),
        gpa = ifelse(sat > 1300,3.9,gpa),
        income = ifelse(sat > 1300,150000,income),
        distance = ifelse(sat > 1300,100,distance))
```


---

# Two Questions

- How can we do something like this?


```{r,message=F}
hypo <- ad %>%
 mutate(net_price = ifelse(sat > 1300, # Logical statement #<<
                            net_price - 1000, # Value if true #<<
                            ifelse(sat < 1300, # Nested logic! #<<
                                   net_price + 1000, # Nested if true #<<
                                   net_price)),
         visit = ifelse(sat > 1300,
                            1,
                            ifelse(sat < 1300,
                                   0,visit)),
         registered = ifelse(sat > 1300,
                            1,
                            ifelse(sat < 1300,
                                   0,registered)),
        legacy = ifelse(sat > 1300,1,legacy),
        gpa = ifelse(sat > 1300,3.9,gpa),
        income = ifelse(sat > 1300,150000,income),
        distance = ifelse(sat > 1300,100,distance))
```


---

# Two Questions

- How can we do something like this?


```{r,message=F}
hypo <- ad %>%
 mutate(net_price = ifelse(sat > 1300, # Logical statement #<<
                            net_price - 1000, # Value if true #<<
                            ifelse(sat < 1300, # Nested logic! #<<
                                   net_price + 1000, # Nested if true #<<
                                   net_price)),# Nested if false #<<
         visit = ifelse(sat > 1300,
                            1,
                            ifelse(sat < 1300,
                                   0,visit)),
         registered = ifelse(sat > 1300,
                            1,
                            ifelse(sat < 1300,
                                   0,registered)),
        legacy = ifelse(sat > 1300,1,legacy),
        gpa = ifelse(sat > 1300,3.9,gpa),
        income = ifelse(sat > 1300,150000,income),
        distance = ifelse(sat > 1300,100,distance))
```


---

# Two Questions

- How can we do something like this?


```{r,message=F}
hypo <- ad %>%
 mutate(net_price = ifelse(sat > 1300, 
                            net_price - 1000, 
                            ifelse(sat < 1300, 
                                   net_price + 1000, 
                                   net_price)),
         visit = ifelse(sat > 1300,
                            1,
                            ifelse(sat < 1300,
                                   0,visit)),
         registered = ifelse(sat > 1300,
                            1,
                            ifelse(sat < 1300,
                                   0,registered)),
        legacy = ifelse(sat > 1300,1,legacy), #<<
        gpa = ifelse(sat > 1300,3.9,gpa),
        income = ifelse(sat > 1300,150000,income),
        distance = ifelse(sat > 1300,100,distance))
```

---

# Two Questions

- How can we do something like this?

--

  1. **Mechanically:** It's just `code`

--

  2. **Substantively:** Employers ask these questions

--

  3. **Practically:** ??

--

  4. **Ethically:** ????

---

# Student Questions

<center><img src="https://i.giphy.com/media/fdLR6LGwAiVNhGQNvf/giphy.webp"></center>